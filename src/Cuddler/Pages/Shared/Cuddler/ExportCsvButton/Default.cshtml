@using global::Cuddler.Utils
@using global::Cuddler.Web.Helpers
@model ExportCsvButtonTagHelper
@{
    var buttonId = WebIdUtil.GetWebId();
    var classValues = EButtonTypeHelper.ToString(EButtonType.Light);
    var uri = Model.ExportUri.ToString();
}

<script type="text/x-kendo-template"
        id="@Model.ClientTemplateId">
     <span class="eux-PrintButton">
        <button class="@classValues"
                id="@buttonId"
                type="button">
            <span class="eux-Icon">
                <i class="fa-regular fa-file-csv fa-2x"></i>
            </span>
        </button>
    </span>
</script>

<script>
    $(function(){
        $("#@buttonId").click(function() {
        $.ajax({
            url: "@Html.Raw(uri)",
            cache: false,
            xhr: function () {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 2) {
                        if (xhr.status == 200) {
                            xhr.responseType = "blob";
                        } else {
                            xhr.responseType = "text";
                        }
                    }
                };
                return xhr;
            },
            success: function (data) {
                //Convert the Byte Data to BLOB object.
                var blob = new Blob([data], { type: "application/octetstream" });
                //Check the Browser type and download the File.
                var isIE = false || !!document.documentMode;
                if (isIE) {
                    window.navigator.msSaveBlob(blob, fileName);
                } else {
                    var url = window.URL || window.webkitURL;
                    link = url.createObjectURL(blob);
                    var a = $("<a />");
                    a.attr("download", fileName);
                    a.attr("href", link);
                    $("body").append(a);
                    a[0].click();
                    $("body").remove(a);
                }
            }
        });
        });
    })
</script>